import React, {useState, useLayoutEffect, useContext} from 'react';
import Context from "../../Context/Context"

import styles from './styles.module.scss';

const ShareModal = () => {
    const context = useContext(Context)
    const {device, cafes} = context.state
    const isModalOpen = context.state.shareModalOpen
    const modalPage = context.state.shareModalPage
    const postId = context.state.shareModalId
    const [copy, setCopy] = useState(false)
    const [currentCafe, setCurrentCafe] = useState(null)

    useLayoutEffect(() => {
        if (isModalOpen) {
            document.body.style.overflow = "hidden"
            setCurrentCafe(cafes.read().find(el => el.id === postId))
        } else {
            document.body.style.overflow = ""
        }
    }, [isModalOpen])

    const onModalClose = () => {
        context.update({
            shareModalOpen: false,
            shareModalPage: null,
            shareModalId: null
        })
    }

    const copyToClipboard = () => {
        const el = document.createElement('textarea');
        el.value = `${window.location.origin}/${modalPage}/${postId}`
        el.setAttribute('readonly', '')
        el.style.position = 'absolute'
        el.style.left = '-9999px'
        document.body.appendChild(el)
        el.select()
        document.execCommand('copy')
        document.body.removeChild(el)
        setCopy(true)
        setTimeout(() => setCopy(false), 3000)
    }

    return (
        <>
            {isModalOpen &&
                <section className={styles.modalBackground}
                    onClick={onModalClose}
                >
                    <div className={styles.linksModal}
                        onClick={e => e.stopPropagation()}
                    >
                        <div className={styles.closeBtn}
                            onClick={onModalClose}
                        >
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 1L1 15M1 1L15 15" stroke="#727272" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                        </div>

                        <h4>Поделиться местом</h4>

                        <ul className={styles.icons}>
                            <li>
                                <a
                                    href={`https://vk.com/share.php?url=${window.location.origin}/${modalPage}/${postId}&title=${currentCafe && currentCafe.title}&image=${currentCafe && currentCafe.photos[0]["640"]}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 112.196 112.196"
                                        style={{enableBackground: "new 0 0 112.196 112.196"}}
                                        xmlSpace="preserve"
                                    >
                                        <g>
                                            <g>
                                                <circle id="XMLID_11_" style={{fill: "#4D76A1"}} cx="56.098" cy="56.098" r="56.098"/>
                                            </g>
                                            <path
                                                style={{fillRule:"evenodd", clipRule: "evenodd",fill: "#FFFFFF"}}
                                                d="M53.979,80.702h4.403c0,0,1.33-0.146,2.009-0.878
                                                c0.625-0.672,0.605-1.934,0.605-1.934s-0.086-5.908,2.656-6.778c2.703-0.857,6.174,5.71,9.853,8.235
                                                c2.782,1.911,4.896,1.492,4.896,1.492l9.837-0.137c0,0,5.146-0.317,2.706-4.363c-0.2-0.331-1.421-2.993-7.314-8.463
                                                c-6.168-5.725-5.342-4.799,2.088-14.702c4.525-6.031,6.334-9.713,5.769-11.29c-0.539-1.502-3.867-1.105-3.867-1.105l-11.076,0.069
                                                c0,0-0.821-0.112-1.43,0.252c-0.595,0.357-0.978,1.189-0.978,1.189s-1.753,4.667-4.091,8.636c-4.932,8.375-6.904,8.817-7.71,8.297
                                                c-1.875-1.212-1.407-4.869-1.407-7.467c0-8.116,1.231-11.5-2.397-12.376c-1.204-0.291-2.09-0.483-5.169-0.514
                                                c-3.952-0.041-7.297,0.012-9.191,0.94c-1.26,0.617-2.232,1.992-1.64,2.071c0.732,0.098,2.39,0.447,3.269,1.644
                                                c1.135,1.544,1.095,5.012,1.095,5.012s0.652,9.554-1.523,10.741c-1.493,0.814-3.541-0.848-7.938-8.446
                                                c-2.253-3.892-3.954-8.194-3.954-8.194s-0.328-0.804-0.913-1.234c-0.71-0.521-1.702-0.687-1.702-0.687l-10.525,0.069
                                                c0,0-1.58,0.044-2.16,0.731c-0.516,0.611-0.041,1.875-0.041,1.875s8.24,19.278,17.57,28.993
                                                C44.264,81.287,53.979,80.702,53.979,80.702L53.979,80.702z"
                                            />
                                        </g>
                                    </svg>
                                </a>
                            </li>

                            <li>
                                <a
                                    href={`https://www.facebook.com/sharer.php?u=${encodeURIComponent(`${window.location.origin}/${modalPage}/${postId}`)}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    <svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M46 23C46 35.7025 35.7025 46 23 46C10.2975 46 0 35.7025 0 23C0 10.2975 10.2975 0 23 0C35.7025 0 46 10.2975 46 23ZM21.4235 12.2489C22.4877 11.1917 24.0038 10.6567 25.7588 10.6567C27.324 10.6567 29.036 10.7845 29.5102 10.8474C29.6392 10.8645 29.7575 10.9277 29.8433 11.0255C29.9291 11.1232 29.9765 11.2488 29.9767 11.3789V15.4867C29.9767 15.629 29.9201 15.7655 29.8195 15.8661C29.7188 15.9668 29.5823 16.0233 29.44 16.0233H26.22C25.6207 16.0233 25.1467 16.4974 25.1467 17.0967V19.2433H29.44C29.5161 19.2433 29.5914 19.2595 29.6608 19.2909C29.7302 19.3222 29.7921 19.3679 29.8425 19.425C29.8929 19.4821 29.9305 19.5493 29.9529 19.6221C29.9753 19.6948 29.982 19.7715 29.9725 19.8471L29.4358 24.1404C29.4195 24.2701 29.3563 24.3894 29.2583 24.4758C29.1603 24.5623 29.034 24.61 28.9033 24.61H25.1467V34.8067C25.1467 34.949 25.0901 35.0855 24.9895 35.1861C24.8888 35.2868 24.7523 35.3433 24.61 35.3433H20.3167C20.1743 35.3433 20.0378 35.2868 19.9372 35.1861C19.8366 35.0855 19.78 34.949 19.78 34.8067V24.61H16.56C16.4177 24.61 16.2812 24.5534 16.1805 24.4528C16.0799 24.3522 16.0233 24.2157 16.0233 24.0733V19.78C16.0233 19.6377 16.0799 19.5012 16.1805 19.4005C16.2812 19.2999 16.4177 19.2434 16.56 19.2433H19.78V16.7571C19.78 14.8555 20.3594 13.306 21.4235 12.2489Z" fill="#3765A3"/>
                                        <path fillRule="evenodd" clipRule="evenodd" d="M46 23C46 35.7025 35.7025 46 23 46C10.2975 46 0 35.7025 0 23C0 10.2975 10.2975 0 23 0C35.7025 0 46 10.2975 46 23ZM21.4235 12.2489C22.4877 11.1917 24.0038 10.6567 25.7588 10.6567C27.324 10.6567 29.036 10.7845 29.5102 10.8474C29.6392 10.8645 29.7575 10.9277 29.8433 11.0255C29.9291 11.1232 29.9765 11.2488 29.9767 11.3789V15.4867C29.9767 15.629 29.9201 15.7655 29.8195 15.8661C29.7188 15.9668 29.5823 16.0233 29.44 16.0233H26.22C25.6207 16.0233 25.1467 16.4974 25.1467 17.0967V19.2433H29.44C29.5161 19.2433 29.5914 19.2595 29.6608 19.2909C29.7302 19.3222 29.7921 19.3679 29.8425 19.425C29.8929 19.4821 29.9305 19.5493 29.9529 19.6221C29.9753 19.6948 29.982 19.7715 29.9725 19.8471L29.4358 24.1404C29.4195 24.2701 29.3563 24.3894 29.2583 24.4758C29.1603 24.5623 29.034 24.61 28.9033 24.61H25.1467V34.8067C25.1467 34.949 25.0901 35.0855 24.9895 35.1861C24.8888 35.2868 24.7523 35.3433 24.61 35.3433H20.3167C20.1743 35.3433 20.0378 35.2868 19.9372 35.1861C19.8366 35.0855 19.78 34.949 19.78 34.8067V24.61H16.56C16.4177 24.61 16.2812 24.5534 16.1805 24.4528C16.0799 24.3522 16.0233 24.2157 16.0233 24.0733V19.78C16.0233 19.6377 16.0799 19.5012 16.1805 19.4005C16.2812 19.2999 16.4177 19.2434 16.56 19.2433H19.78V16.7571C19.78 14.8555 20.3594 13.306 21.4235 12.2489Z" fill="#3765A3"/>
                                    </svg>
                                </a>
                            </li>

                            <li>
                                <svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M27.4023 23C27.4023 25.4314 25.4314 27.4023 23 27.4023C20.5686 27.4023 18.5977 25.4314 18.5977 23C18.5977 20.5686 20.5686 18.5977 23 18.5977C25.4314 18.5977 27.4023 20.5686 27.4023 23Z" fill="url(#paint0_linear)"/>
                                    <path d="M33.2955 15.2109C33.0838 14.6374 32.7462 14.1184 32.3075 13.6923C31.8815 13.2536 31.3628 12.916 30.789 12.7044C30.3236 12.5237 29.6245 12.3085 28.3369 12.2499C26.9439 12.1864 26.5263 12.1727 22.9999 12.1727C19.4732 12.1727 19.0556 12.186 17.663 12.2496C16.3754 12.3085 15.6759 12.5237 15.2109 12.7044C14.6371 12.916 14.118 13.2536 13.6923 13.6923C13.2536 14.1184 12.916 14.6371 12.7041 15.2109C12.5233 15.6763 12.3082 16.3757 12.2496 17.6634C12.186 19.0559 12.1724 19.4736 12.1724 23.0003C12.1724 26.5266 12.186 26.9443 12.2496 28.3372C12.3082 29.6249 12.5233 30.324 12.7041 30.7893C12.916 31.3631 13.2533 31.8818 13.692 32.3079C14.118 32.7466 14.6367 33.0842 15.2106 33.2958C15.6759 33.4769 16.3754 33.692 17.663 33.7507C19.0556 33.8142 19.4729 33.8275 22.9996 33.8275C26.5267 33.8275 26.9443 33.8142 28.3365 33.7507C29.6242 33.692 30.3236 33.4769 30.789 33.2958C31.9408 32.8515 32.8512 31.9411 33.2955 30.7893C33.4762 30.324 33.6913 29.6249 33.7503 28.3372C33.8138 26.9443 33.8272 26.5266 33.8272 23.0003C33.8272 19.4736 33.8138 19.0559 33.7503 17.6634C33.6917 16.3757 33.4766 15.6763 33.2955 15.2109ZM22.9999 29.7817C19.2542 29.7817 16.2178 26.7456 16.2178 22.9999C16.2178 19.2542 19.2542 16.2181 22.9999 16.2181C26.7453 16.2181 29.7817 19.2542 29.7817 22.9999C29.7817 26.7456 26.7453 29.7817 22.9999 29.7817ZM30.0499 17.5349C29.1746 17.5349 28.465 16.8253 28.465 15.95C28.465 15.0747 29.1746 14.3651 30.0499 14.3651C30.9251 14.3651 31.6348 15.0747 31.6348 15.95C31.6344 16.8253 30.9251 17.5349 30.0499 17.5349Z" fill="url(#paint1_linear)"/>
                                    <path d="M23 0C10.2994 0 0 10.2994 0 23C0 35.7006 10.2994 46 23 46C35.7006 46 46 35.7006 46 23C46 10.2994 35.7006 0 23 0ZM36.1274 28.445C36.0635 29.8509 35.8399 30.8108 35.5135 31.651C34.8274 33.425 33.425 34.8274 31.651 35.5135C30.8111 35.8399 29.8509 36.0631 28.4454 36.1274C27.037 36.1916 26.5871 36.207 23.0004 36.207C19.4133 36.207 18.9637 36.1916 17.555 36.1274C16.1494 36.0631 15.1892 35.8399 14.3494 35.5135C13.4678 35.1819 12.6697 34.6621 12.0099 33.9901C11.3382 33.3306 10.8185 32.5322 10.4868 31.651C10.1604 30.8111 9.93686 29.8509 9.87299 28.4454C9.80806 27.0367 9.79297 26.5867 9.79297 23C9.79297 19.4133 9.80806 18.9633 9.87263 17.555C9.93651 16.1491 10.1597 15.1892 10.4861 14.349C10.8177 13.4678 11.3379 12.6694 12.0099 12.0099C12.6694 11.3379 13.4678 10.8181 14.349 10.4865C15.1892 10.1601 16.1491 9.93686 17.555 9.87263C18.9633 9.80841 19.4133 9.79297 23 9.79297C26.5867 9.79297 27.0367 9.80841 28.445 9.87299C29.8509 9.93686 30.8108 10.1601 31.651 10.4861C32.5322 10.8177 33.3306 11.3379 33.9904 12.0099C34.6621 12.6697 35.1823 13.4678 35.5135 14.349C35.8403 15.1892 36.0635 16.1491 36.1277 17.555C36.1919 18.9633 36.207 19.4133 36.207 23C36.207 26.5867 36.1919 27.0367 36.1274 28.445Z" fill="url(#paint2_linear)"/>
                                    <defs>
                                    <linearGradient id="paint0_linear" x1="23" y1="1.885e-06" x2="23" y2="46" gradientUnits="userSpaceOnUse">
                                    <stop stopColor="#FF9E2D"/>
                                    <stop offset="0.828125" stopColor="#C22ACF"/>
                                    <stop offset="1" stopColor="#CD1B1B" stopOpacity="0.94"/>
                                    </linearGradient>
                                    <linearGradient id="paint1_linear" x1="23" y1="1.885e-06" x2="23" y2="46" gradientUnits="userSpaceOnUse">
                                    <stop stopColor="#FF9E2D"/>
                                    <stop offset="0.828125" stopColor="#C22ACF"/>
                                    <stop offset="1" stopColor="#CD1B1B" stopOpacity="0.94"/>
                                    </linearGradient>
                                    <linearGradient id="paint2_linear" x1="23" y1="1.885e-06" x2="23" y2="46" gradientUnits="userSpaceOnUse">
                                    <stop stopColor="#FF9E2D"/>
                                    <stop offset="0.828125" stopColor="#C22ACF"/>
                                    <stop offset="1" stopColor="#CD1B1B" stopOpacity="0.94"/>
                                    </linearGradient>
                                    </defs>
                                </svg>
                            </li>
                            
                            <li onClick={copyToClipboard}>
                                <svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="23" cy="23" r="23" fill="#467AFF"/>
                                    <path d="M12.9091 23.0002C12.9091 20.8698 14.6408 19.1381 16.7712 19.1381H21.7545V16.771H16.7712C13.3327 16.771 10.542 19.5617 10.542 23.0002C10.542 26.4387 13.3327 29.2293 16.7712 29.2293H21.7545V26.8622H16.7712C14.6408 26.8622 12.9091 25.1305 12.9091 23.0002ZM18.017 24.246H27.9837V21.7543H18.017V24.246ZM29.2295 16.771H24.2462V19.1381H29.2295C31.3599 19.1381 33.0916 20.8698 33.0916 23.0002C33.0916 25.1305 31.3599 26.8622 29.2295 26.8622H24.2462V29.2293H29.2295C32.668 29.2293 35.4587 26.4387 35.4587 23.0002C35.4587 19.5617 32.668 16.771 29.2295 16.771Z" fill="white"/>
                                </svg>
                            </li>
                        </ul>

                        {copy && device !== "mobile" &&
                            <div className={styles.copySuccess}>
                                Ссылка скопирована
                            </div>
                        }
                    </div>

                    {copy && device === "mobile" &&
                        <div className={styles.copySuccess}>
                            Ссылка скопирована
                        </div>
                    }
                </section>
            }
        </>
    )
}

export default React.memo(ShareModal);
